<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MGC Player</title>
  <style>
    body {{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }}
    .wrap {{ max-width: 980px; margin: 0 auto; }}
    h1 {{ margin: 0 0 8px 0; }}
    .meta {{ color: #444; margin-bottom: 18px; }}
    .card {{ border: 1px solid #ddd; border-radius: 10px; padding: 14px 14px; margin: 12px 0; }}
    .row {{ display: flex; justify-content: space-between; gap: 12px; align-items: baseline; flex-wrap: wrap; }}
    .title {{ font-weight: 700; }}
    .small {{ color: #555; font-size: 0.95rem; }}
    audio {{ width: 100%; margin-top: 8px; }}
    code {{ background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }}
    a {{ color: inherit; }}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>MGC Player</h1>
    <div class="meta">
      Built at <code id="builtAt"></code> • Playlist: <code id="plistName"></code>
    </div>

    <div id="stats" class="small"></div>
    <div id="tracks"></div>

    <div class="meta small">
      Tip: serve the repo root so <code>/data/...</code> paths resolve.
      Example: <code>python -m mgc.main web serve</code>
    </div>
  </div>

<script>
  const PLAYLIST = {"dedupe": {"applied": false, "excluded_count": 3, "reason": "not_enough_unique_tracks", "requested_lookback": 3}, "filters": {"bpm_window": [80, 125], "context": "focus", "genre": null, "lookback_playlists": 3, "mood": "focus", "seed": 1, "target_minutes": 20}, "items": [{"bpm": 110, "created_at": "2026-01-07T14:15:06.007273+00:00", "duration_sec": 60.0, "full_path": "data/tracks/20260107_9721c20d.wav", "genre": "ambient electronic", "mood": "focus", "preview_path": "data/previews/20260107_9721c20d_preview.mp3", "title": "Daily Drop 2026-01-07 (Focus)", "track_id": "9721c20d-6e89-4407-8cee-a5b6c3a651ed"}, {"bpm": 110, "created_at": "2026-01-07T06:38:52.910050+00:00", "duration_sec": 60.0, "full_path": "data/tracks/20260107_fcf455d5.wav", "genre": "ambient electronic", "mood": "focus", "preview_path": "data/previews/20260107_fcf455d5_preview.mp3", "title": "Daily Drop 2026-01-07 (Focus)", "track_id": "fcf455d5-df2c-450b-b79a-8117fe7cea7a"}, {"bpm": 110, "created_at": "2026-01-07T17:21:54.469612+00:00", "duration_sec": 30.0, "full_path": "data/tracks/20260107_67159c3a.mp3", "genre": "ambient electronic", "mood": "focus", "preview_path": "data/previews/20260107_67159c3a_preview.mp3", "title": "Daily Drop 2026-01-07 (Focus)", "track_id": "67159c3a-04b0-449b-a786-51b7731f6b75"}], "name": "Focus Radio", "stats": {"avg_bpm": 110, "bpm_max": 110, "bpm_min": 110, "duration_minutes": 2.5, "genre_counts": {"ambient electronic": 3}, "mood_counts": {"focus": 3}, "total_duration_sec": 150, "track_count": 3, "unique_track_count": 3}};
  const BUILT_AT = "2026-01-11T23:34:42.293631+00:00";

  document.getElementById("builtAt").textContent = BUILT_AT;
  document.getElementById("plistName").textContent = PLAYLIST.name || "playlist";

  const s = PLAYLIST.stats || {{}};
  const statsText = [
    s.track_count != null ? `tracks=${s.track_count}` : null,
    s.duration_minutes != null ? `minutes=${s.duration_minutes}` : null,
    s.avg_bpm != null ? `avg_bpm=${s.avg_bpm}` : null,
  ].filter(Boolean).join(" • ");
  document.getElementById("stats").textContent = statsText;

  const wrap = document.getElementById("tracks");
  const items = PLAYLIST.items || [];
  if (!items.length) {{
    wrap.innerHTML = "<div class='card'>No tracks found in playlist JSON.</div>";
  }} else {{
    for (const [idx, t] of items.entries()) {{
      const card = document.createElement("div");
      card.className = "card";

      const title = document.createElement("div");
      title.className = "row";
      title.innerHTML = `
        <div>
          <span class="title">${{idx + 1}}. ${{t.title || t.track_id}}</span>
          <div class="small">${{t.mood || ""}} • ${{t.genre || ""}} • bpm=${{t.bpm ?? "?"}} • ${{Math.round((t.duration_sec || 0))}}s</div>
        </div>
        <div class="small"><code>${{t.track_id}}</code></div>
      `;

      const audio = document.createElement("audio");
      audio.controls = true;
      const src = document.createElement("source");
      src.src = "/" + (t.preview_path || t.full_path || "").replace(/^\/+/, "");
      src.type = "audio/mpeg";
      audio.appendChild(src);

      const links = document.createElement("div");
      links.className = "small";
      const full = "/" + (t.full_path || "").replace(/^\/+/, "");
      links.innerHTML = full ? `Full: <a href="${{full}}">${{full}}</a>` : "";

      card.appendChild(title);
      card.appendChild(audio);
      card.appendChild(links);
      wrap.appendChild(card);
    }}
  }}
</script>
</body>
</html>
